# apps/api/data データ概要  
_Fukuoka Bus Challenge Planner Core Data Files_

このディレクトリには、バス経路自動生成アルゴリズム（RAPTOR／Simple RAPTOR／TSPヒューリスティック）が使用する基礎データを格納しています。  
各ファイルは停留所情報、路線構造、フリーパス対象判定に関する情報を保持し、API 起動時に自動的に読み込まれます。

---

## line_stop_edges.csv

### 概要（Description）
各バス路線の停留所順序を定義するファイルです。
RAPTOR アルゴリズムが時刻表を構築する際の「線形区間（エッジ）」情報として利用されます。

### データ構成（Columns）

| 列名 | 型 | 内容 |
|------|----|------|
| `line_id` | string | 路線ID |
| `station_code` | string | 該当路線の停留所コード（順番通りに複数行で記録） |

### 例（Example）
```csv
line_id,station_code
1029,675435
1029,675437
1029,675439
```

### データ生成源（Source）
tools/fetch_operation_lines.py
→ /search/course/extreme API から路線データを取得し、停留所順を整形してCSV化します。

---

## stations.csv

### 概要（Description）
全停留所の基本情報を格納します。  
主に経路探索時の座標計算や停留所間距離の算出に利用されます。

### データ構成（Columns）

| 列名 | 型 | 内容 |
|------|----|------|
| `ekispert_station_code` | string | 停留所コード（一意識別子） |
| `name` | string | 停留所名および事業者名 |
| `lat` | float | 緯度（WGS84） |
| `lon` | float | 経度（WGS84） |

### 例（Example）
```csv
ekispert_station_code,name,lat,lon
674018,相生町／西鉄バス,33.846922,130.753882
674408,合川／西鉄バス,33.309089,130.55325
674286,相川／西鉄バス,33.25716,130.512416
677152,相田／西鉄バス,33.65835,130.66135
```

### データ生成源（Source）
tools/fetch_dump_stations.py
→ Mixway API から停留所データを取得し、CSV 形式で出力します。


---

## freepass_lines.yml

### 概要（Description）
「福岡市内1日フリーパス」対象の路線を記録します。
経路生成時、eligible: true の路線のみを探索対象とします。

### データ構成（Columns）
YAML 形式で、各路線の属性およびフリーパス適用可否を記録しています。
| フィールド名 | 型 | 内容 |
|------|----|------|
| `line_id` | string | 路線ID |
| `corporation` | string | 運行事業者 |
| `name` | string | 路線名 |
| `stops_inside` | int | 福岡市内の停留所数 |
| `stops_outside` | int | 福岡市外の停留所数 |
| `stops_unknown` | int | 境界不明停留所数 |
| `eligible` | bool | フリーパス対象フラグ |
| `reason` | string | 判定理由（例: "ok", "too_many_outside"） |

### 例（Example）
```yaml
# generated by tag_freepass.py
freepass_lines:
  - line_id: "1029"
    corporation: "西鉄バス"
    name: "西鉄バス・１・普通・福岡タワー・医療Ｃ構内行"
    stops_inside: 21
    stops_outside: 0
    stops_unknown: 0
    eligible: true
    reason: "ok"
  - line_id: "1036"
    corporation: "西鉄バス"
    name: "西鉄バス・１－５・普通・藤崎－福岡タワー南口・医療Ｃ構内行"
    stops_inside: 27
    stops_outside: 0
    stops_unknown: 0
    eligible: true
    reason: "ok"
```

### データ生成源（Source）
tools/tag_freepass.py
→ line_stop_edges.csv 内の停留所座標と fukuoka_city.geojson（市境界データ）を照合して判定。

---

## 関連ファイル
| ファイル名 | 用途 | 
|------|------|
| `fukuoka_city.geojson` | 福岡市の行政境界ポリゴン。フリーパス判定に利用。 |

# 更新履歴
| 日付| 内容 | 
|------|------|
| `2025-11-10` | 初版作成。3つのコアデータファイルの説明を統合。 |

Last Updated: 2025/11/10